Weâ€™ll do this end-to-end from absolute scratch, exactly like a real production lab.

You will end with:

- A new GitHub repo
- Java app v1 & v2
- Docker images built & pushed
- Argo CD + Argo Rollouts installed
- Blue-Green deployment using Istio VirtualService
- Manual promotion using kubectl argo rollouts promote

ğŸ§ª FULL LAB: Blue-Green Deployment with Argo CD + Argo Rollouts + Istio

ğŸ§  Architecture (What You Are Building)

GitHub Repo
   â†“
Argo CD (GitOps Sync)
   â†“
Argo Rollouts (Blue-Green Logic)
   â†“
Kubernetes Services (Active / Preview)
   â†“
Istio VirtualService
   â†“
Users

0ï¸âƒ£ Prerequisites (Local Machine)
kubectl version
docker version
git --version
Cluster must already have Istio installed (you already have this).

1ï¸âƒ£ Create New GitHub Repository
student-management-rollouts

git clone https://github.com/vivekbagde1203/student-management-rollouts.git
cd student-management-rollouts

2ï¸âƒ£ Java App Source Code (v1 & v2)
ğŸ“ Folder Structure

app/
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ pom.xml
â””â”€â”€ src/main/java/com/example/App.java

ğŸ”¹ Java Source Code (v1)
package com.example;

import static spark.Spark.*;

public class App {
    public static void main(String[] args) {
        port(8080);

        get("/", (req, res) -> "Student Management App - VERSION v1 (BLUE)");
    }
}

ğŸ”¹ Java Source Code (v2 â€“ change only text)

get("/", (req, res) -> "Student Management App - VERSION v2 (GREEN)");

ğŸ”¹ pom.xml
<project xmlns="http://maven.apache.org/POM/4.0.0">
  <modelVersion>4.0.0</modelVersion>

  <groupId>com.example</groupId>
  <artifactId>student-management</artifactId>
  <version>1.0</version>

  <dependencies>
    <dependency>
      <groupId>com.sparkjava</groupId>
      <artifactId>spark-core</artifactId>
      <version>2.9.4</version>
    </dependency>
  </dependencies>
</project>

3ï¸âƒ£ Dockerfile (Same for v1 & v2)
FROM eclipse-temurin:17-jre-alpine
WORKDIR /app
COPY target/student-management-1.0.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java","-jar","app.jar"]


4ï¸âƒ£ Build JAR & Docker Images
mvn clean package

Build & Push v1 Image
docker build -t projectdocker1203/student-management:v1 .
docker push projectdocker1203/student-management:v1
docker buildx build --platform linux/amd64 -t projectdocker1203/student-management-argo:v1 --push .

Change Code â†’ v2 â†’ Build & Push
docker build -t projectdocker1203/student-management:v2 .
docker push projectdocker1203/student-management:v2
docker buildx build --platform linux/amd64 -t projectdocker1203/student-management-argo:v2 --push .

5ï¸âƒ£ Install Argo CD (Cluster)
kubectl create namespace argocd

kubectl apply -n argocd \
  -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml

kubectl port-forward svc/argocd-server -n argocd 8080:443

kubectl get secret argocd-initial-admin-secret \
  -n argocd -o jsonpath="{.data.password}" | base64 -d

edit argocd-server deployment and add argument:
- args: 
- /usr/local/bin/argocd-server 
- --port=8080 
- --metrics-port=8083 
- --insecure #this need to add

6ï¸âƒ£ Install Argo Rollouts (Cluster)
kubectl create namespace argo-rollouts

kubectl apply -n argo-rollouts \
  -f https://github.com/argoproj/argo-rollouts/releases/latest/download/install.yaml

kubectl get pods -n argo-rollouts

7ï¸âƒ£ Install CLI Tools (Local)
Argo CD CLI
brew install argocd

Argo Rollouts CLI
curl -LO https://github.com/argoproj/argo-rollouts/releases/latest/download/kubectl-argo-rollouts-darwin-arm64
chmod +x kubectl-argo-rollouts-darwin-arm64
sudo mv kubectl-argo-rollouts-darwin-arm64 /usr/local/bin/kubectl-argo-rollouts

argocd version
kubectl argo rollouts version

8ï¸âƒ£ Kubernetes Manifests (GitOps)
student-management/
â”œâ”€â”€ rollout.yaml
â”œâ”€â”€ service-active.yaml
â”œâ”€â”€ service-preview.yaml
â”œâ”€â”€ gateway.yaml
â”œâ”€â”€ virtualservice.yaml
â””â”€â”€ argocd-app.yaml

ğŸ”¹ rollout.yaml (Blue-Green)
apiVersion: argoproj.io/v1alpha1
kind: Rollout
metadata:
  name: student-management
spec:
  replicas: 4
  selector:
    matchLabels:
      app: student-management
  template:
    metadata:
      labels:
        app: student-management
    spec:
      containers:
      - name: app
        image: projectdocker1203/student-management:v1
        ports:
        - containerPort: 8080

  strategy:
    blueGreen:
      activeService: student-active
      previewService: student-preview
      autoPromotionEnabled: false

ğŸ”¹ service-active.yaml
apiVersion: v1
kind: Service
metadata:
  name: student-active
spec:
  selector:
    app: student-management
  ports:
  - port: 80
    targetPort: 8080

ğŸ”¹ service-preview.yaml
apiVersion: v1
kind: Service
metadata:
  name: student-preview
spec:
  selector:
    app: student-management
  ports:
  - port: 80
    targetPort: 8080

ğŸ”¹ gateway.yaml (Istio)
apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: student-gateway
spec:
  selector:
    istio: ingressgateway
  servers:
  - port:
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - "*"

ğŸ”¹ virtualservice.yaml (STATIC)
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: student-vs
spec:
  gateways:
  - istio-system/student-gateway
  hosts:
  - "*"
  http:
  - route:
    - destination:
        host: student-active
        port:
          number: 80


ğŸ”¹ argocd-app.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: student-management
  namespace: argocd
spec:
  project: default
  source:
    repoURL: https://github.com/vivekbagde1203/student-management-rollouts.git
    targetRevision: main
    path: student-management
  destination:
    server: https://kubernetes.default.svc
    namespace: default
  syncPolicy:
    automated:
      prune: true
      selfHeal: true

9ï¸âƒ£ Git Push & Sync
git add .
git commit -m "Initial blue-green setup v1"
git push origin main


argocd app sync student-management

ğŸ”Ÿ Deploy v2 (GREEN)
Edit rollout.yaml:
image: projectdocker1203/student-management:v2

git commit -am "Deploy v2"
git push

1ï¸âƒ£1ï¸âƒ£ Promote (THIS IS THE TEST)
kubectl argo rollouts promote student-management

âœ” VirtualService unchanged
âœ” Service selectors switch
âœ” Traffic moves instantly

ğŸ” Observe Like a Pro
kubectl argo rollouts get rollout student-management
kubectl describe svc student-active





